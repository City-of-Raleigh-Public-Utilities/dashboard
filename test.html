
<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>Public Utilities GIS Edits Dashboard</title>

    <!-- Bootstrap core CSS -->
    <link href="../dashboard/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../dashboard/dist/css/stylesheet.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../dashboard/dist/css/jumbotron.css" rel="stylesheet">
    <link rel="icon" type="image/ico" href="../dashboard/dist/img/favicon.ico" />

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" style="background-color:#5c8fea;" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" style="color:white;" href="../dashboard/index.html">Public Utilites Dashboard</a>
        </div>
        <div class="navbar-collapse collapse" >
          <ul class="nav navbar-nav" style="background-color:#5c8fea;">
            <li class="dropdown">
          <a href="../dashboard/water.html" class="dropdown-toggle" style='color:white;' data-toggle="dropdown">Water <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="../dashboard/water.html">Water Stats</a></li>
            <li class="divider"></li>
            <li><a href="../dashboard/water.html#mainsPieChartContainer">Water Mains</a></li>
            <li><a href="../dashboard/water.html#lateralPieChartContainer">Water Laterals</a></li>
            <li><a href="../dashboard/water.html#valvesPieChartContainer">Water Valves</a></li>
            <li><a href="../dashboard/water.html#fittingChart">Water Fittings</a></li>
          </ul>
        </li>
         <li class="dropdown">
          <a href="../dashboard/sewer.html" class="dropdown-toggle" style='color:white;' data-toggle="dropdown">Sewer<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="../dashboard/sewer.html">Sewer Stats</a></li>
            <li class="divider"></li>
            <li><a href="../dashboard/sewer.html#gravmainsPieChartContainer">Gravity Mains</a></li>
            <li><a href="../dashboard/sewer.html#forcemainPieChartContainer">Force Mains</a></li>
            <li><a href="../dashboard/sewer.html#lateralPieChartContainer">Laterals</a></li>
            <li><a href="../dashboard/sewer.html#manholesPieChartContainer">Manholes</a></li>
            <li><a href="../dashboard/sewer.html#cleanoutPieChartContainer">Cleanouts</a></li>
            <li><a href="../dashboard/sewer.html#fittingChart">Fittings</a></li>
          </ul>
        </li>
            
          </ul>
          
        </div><!--/.navbar-collapse -->
      </div>
    </div>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    
      <div class="container">
        <br><br>
      </div>
    

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
              <!--<canvas id="radar" width="500" height="500"></canvas>-->
        <div id="gravmainsPieChartContainer" ></div>
        
        <p><a class="btn btn-primary btn-lg" role="button">Learn more &raquo;</a></p>
      </div>
    </div>

    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
          <div class="col-md-12">
            <body>
              <div id="rangeSelectorContainer" style="height:170px;max-width:600px;margin: 0px auto"></div>
            </body>
          </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <h2>Sewer Gravity Mains -Edited</h2>
          
        </div>
        <div class="col-md-4">
          <h2>Manhole Edits</h2>
          <div id="pieChartContainer" style="max-width:800px;height: 400px;"></div>
          <p><a class="btn btn-default" href="#" role="button">View details &raquo;</a></p>
       </div>
        <div class="col-md-4">
          <h2>Heading</h2>
          <div id="pieChartContainer" style="max-width:800px;height: 400px;"></div>
          <p><a class="btn btn-default" href="#" role="button">View details &raquo;</a></p>
        </div>
      </div>

      <hr>

      <footer>
        <p>&copy; Company 2014</p>
      </footer>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="../dashboard/dist/js/globalize.min.js"></script>
    <script src="../dashboard/dist/js/dx.chartjs.js"></script>
    <script src="../dashboard/dist/js/Chart.js"></script>
    <script src="../dashboard/dist/js/bootstrap.min.js"></script>
    <!--<script src="../dashboard/dist/data/sewer.json"></script>-->
    <script src="http://js.arcgis.com/3.8/"></script>
    <script type="text/javascript">

//Radar
//***************************************************************************************

   // var radar = document.getElementById("radar").getContext("2d");
    //var myNewChart = new Chart(ctx).PolarArea(data);


    var radata = {
  labels : ["Water Mains","Water Laterals","Water Valves","Water Fittings","Sewer Gravity Mains","Sewer Force Mains","Sewer Cleanouts","Sewer Manholes","Sewer Laterals", "Sewer Fittings"],
  datasets : [
    {
      fillColor : "rgba(220,220,220,0.5)",
      strokeColor : "rgba(220,220,220,1)",
      pointColor : "rgba(220,220,220,1)",
      pointStrokeColor : "#fff",
      data : [65,59,90,81,56,55,40]
    },
    {
      fillColor : "rgba(151,187,205,0.5)",
      strokeColor : "rgba(151,187,205,1)",
      pointColor : "rgba(151,187,205,1)",
      pointStrokeColor : "#fff",
      data : [28,48,40,19,96,27,100]
    }
  ]
}
    
   // new Chart(radar).Radar(radata);


//*****************************************************************
  
  var index = [14]; //server indexes
  var whereDates = [] //array where query dates will be stored

//*********************************************************************************
function createUrl(index, type){
  var url = "http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/"+ type + "/MapServer/" + index;
  return url;
}
//***********************************************************************************************
function createOutStat(index){
  if (index == 14)
    var statisticDefinition = new esri.tasks.StatisticDefinition();
      statisticDefinition.statisticType = "count";
      statisticDefinition.onStatisticField = "DIAMETER";
      statisticDefinition.outStatisticFieldName = "DIAMETERCOUNT";
    var createdStat =  new esri.tasks.StatisticDefinition();
      createdStat.statisticType = "count";
      createdStat.onStatisticField = "MATERIAL";
      createdStat.outStatisticFieldName = "MATERIALCOUNT"; 
    var outStats = [statisticDefinition, createdStat];

return outStats;
  }
  

//*********************************************************************************
function where(){
  var dateRange = "CREATEDON >= TO_DATE( '2013-8-01 00:00:00' , 'YYYY-MM-DD HH24:MI:SS')" ;//and CREATEDON >= TO_DATE('" + fromDate + "', 'YYYY-MM-DD HH24:MI:SS') and CREATEDON <= TO_DATE('" + toDate + "', 'YYYY-MM-DD HH24:MI:SS')"
  
  return dateRange;
}

  
  

//******************************************************************************
function clearArray(array){
  while (array.length > 0) {
    array.pop();
  }
  
}


//***************************************************************************



function calling(index){
require([
   "dojo/on", "esri/tasks/query", "esri/tasks/QueryTask",  "dojo/dom", "dojo/domReady!", "esri/tasks/StatisticDefinition"
], function(on, Query, QueryTask, dom, StatisticDefinition) {

  var query = new Query();
  var queryTaskSewer = new QueryTask(createUrl(index, 'SewerCollection'), {handleAs: "pjson", callbackParamName: "callback"});
  var queryTaskWater = new QueryTask(createUrl(index, 'WaterDistribution'), {handleAs: "pjson", callbackParamName: "callback"});
  //query.outFields = ['DIAMETER', 'MATERIAL'];
  query.returnGeometry = false;
  query.f = 'pjson';
  query.groupByFieldsForStatistics = ["MATERIAL", "DIAMETER"],
  query.outStatistics = createOutStat(index);
  //query.returnCountOnly = true;

  //on(dom.byId("execute"), "click", execute);

  function execute(){
    query.where = where();
    queryTaskSewer.execute(query, showResults);
    //queryTaskWater.execute(query, showResults);
  }

  ///////////////////////////////////////////////////////////////////////////////////////
  
    function showResults(response) {
      var gravmainData = [];
      var lateralData = [];
      var mainsData = [];
      var fittingsData = [];
      var forcemainData = [];
      var cleanoutData = [];
      var manholeDate = [];
      for (each in response.features){
        
        input = response.features[each].attributes;
       

          var diameterDict = {};
          diameterDict["MATERIAL"] = response.features[each].attributes.MATERIAL
          diameterDict[response.features[each].attributes.DIAMETER] = response.features[each].attributes.DIAMETERCOUNT;

          gravmainData.push(diameterDict);
          
          var gravmainsOptions = barOptions('Gravity Mains Diameter by Material Type', gravmainData, 'MATERIAL');
          $("#gravmainsPieChartContainer").dxChart(gravmainsOptions);
          //piechange("#gravmainsPieChartContainer", gravmainsOptions);
          window.gravmainsOptions = gravmainsOptions;
        
       

      } //end for loop
    
      
      
    } //end of results function
  execute();
  });
  
      
} //end of calling()
for (i in index){
    calling(index[i]);
    }//end of for loop


function barOptions(name, data, arg){
var  options =  {dataSource: data,
            commonSeriesSettings: {
                      argumentField: arg,
                               type: 'stackedBar'
                                  },
                          series: [
                        { valueField: 0, name: '0 - 1' },
                        { valueField: 6, name: 6 },
                        { valueField: 8, name: 8 },
                        { valueField: 10, name: 10 },
                        { valueField: 12, name: 12 },
                        { valueField: 14, name: 14 },
                        { valueField: 15, name: 15 },
                        { valueField: 16, name: 16 },
                        { valueField: 18, name: 18 },
                        { valueField: 20, name: 20 },
                        { valueField: 21, name: 21 },
                        { valueField: 24, name: 24 },
                        { valueField: 30, name: 30 },
                        { valueField: 36, name: 36 },
                        { valueField: 42, name: 42 }

                        
                                  ],
                          legend: {
                  verticalAlignment: 'bottom',
                horizontalAlignment: 'center'
                                  },
                              title: {
                              text: name
                                  }
                                }
                              return options;
}
 // var fittingsOptions = barOptions('Fittings', fittingsData, 'EDITEDBY', 'EDITED', 'CREATED');





    </script>
  </body>
</html>



    </script>
  </body>
</html>
